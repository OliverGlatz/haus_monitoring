"0",""
"0","## PLZ und Geo-Daten bereinigen"
"0","PLZ <- PLZ %>%"
"0","  rename(plz_inserat = X1,"
"0","         stadtname = X2,"
"0","         lng = X3,"
"0","         lat = X4) %>%"
"0","  mutate(plz_inserat = as.character(if_else(nchar(plz_inserat)==4,paste0(""0"",plz_inserat),plz_inserat)),"
"0","         stadtname = str_replace_all(stadtname, c(""Ã¼"" = ""ue"",""Ã¶"" = ""oe"", ""ÃŸ"" = ""ss"", ""Ã¤"" = ""ae"")))"
"0",""
"0",""
"0","# data cleaning"
"0","df <- df %>%"
"0","  mutate(kaufpreis = as.numeric(str_replace_all(kaufpreis, c(""[.]"" = """", "" €"" = """",""[,]"" = "".""))),"
"0","         kaltmiete = as.numeric(str_replace_all(kaltmiete, c(""[.]"" = """", "" €"" = """",""[,]"" = "".""))),"
"0","         warmmiete = as.numeric(str_replace_all(warmmiete, c(""[.]"" = """", "" €"" = """",""[,]"" = "".""))),"
"0","         hausgeld = as.numeric(str_replace_all(hausgeld, c(""[.]"" = """",""[,]"" = ""."", "" €"" = """"))),"
"0","         provision = if_else(str_detect(provision, ""Nein""), FALSE, TRUE),"
"0","         wohnflaeche = as.numeric(str_replace_all(wohnflaeche, c(""[.]"" = """",""[,]"" = ""."", "" m²"" = """"))),"
"0","         nutzflaeche = as.numeric(str_replace_all(nutzflaeche, c(""[.]"" = """",""[,]"" = ""."", "" m²"" = """"))),"
"0","         grundstück = as.numeric(str_replace_all(grundstück, c(""[.]"" = """",""[,]"" = ""."", "" m²"" = """"))),"
"0","         zimmer = as.numeric(str_replace_all(zimmer, c(""[,]"" = "".""))),"
"0","         schlafzimmer = as.numeric(str_replace_all(schlafzimmer, c(""[,]"" = "".""))),"
"0","         badezimmer = as.numeric(str_replace_all(badezimmer, c(""[,]"" = "".""))),"
"0","         ortsteil = stri_extract_last_words(adresse),"
"0","         plz_inserat = as.character(if_else(!grepl(""[^0-9]"", substr(adresse, 1, 5)),substr(adresse, 1, 5),"""")),"
"0","         miete_kaufen = if_else(!is.na(kaltmiete),""miete"", ""kaufen"")) %>%"
"0","  mutate(kaufpreis_pro_qm = (kaufpreis/wohnflaeche),"
"0","         miete_pro_qm = (kaltmiete/wohnflaeche)) %>%"
"0","  dplyr::select(-stadtname) %>%"
"0","  left_join(PLZ, by = c(""plz_inserat"")) %>%"
"0","  filter(!is.na(stadtname))"
"0",""
"0","# Definieren Wohnung und Haus"
"0","df <- df %>% "
"0","  mutate(wohnung_haus = case_when("
"0","    typ == ""Bauernhaus"" ~ ""Haus"","
"0","    typ == ""Besondere Immobilie"" ~ ""Sonstiges"","
"0","    typ == ""Bungalow"" ~ ""Haus"","
"0","    typ == ""Burg/Schloss"" ~ ""Sonstiges"","
"0","    typ == ""Dachgeschoss"" ~ ""Wohnung"","
"0","    typ == ""Doppelhaushälfte"" ~ ""Haus"","
"0","    typ == ""Einfamilienhaus (freistehend)"" ~ ""Haus"","
"0","    typ == ""Erdgeschosswohnung"" ~ ""Wohnung"","
"0","    typ == ""Etagenwohnung"" ~ ""Wohnung"","
"0","    typ == ""Hochparterre"" ~ ""Wohnung"","
"0","    typ == ""Loft"" ~ ""Wohnung"","
"0","    typ == ""Maisonette"" ~ ""Wohnung"","
"0","    typ == ""Mehrfamilienhaus"" ~ ""Haus"","
"0","    typ == ""Penthouse"" ~ ""Wohnung"","
"0","    typ == ""Reiheneckhaus"" ~ ""Haus"","
"0","    typ == ""Reihenmittelhaus"" ~ ""Haus"","
"0","    typ == ""Sonstige"" ~ ""Sonstiges"","
"0","    typ == ""Souterrain"" ~ ""Wohnung"","
"0","    typ == ""Terrassenwohnung"" ~ ""Wohnung"","
"0","    typ == ""Villa"" ~ ""Haus"","
"0","    typ == ""Wohnimmobilie (sonstige)"" ~ ""Sonstiges"","
"0","    is.na(typ) ~ ""Sonstiges""))"
"0",""
"0","# clean monitoring daten"
"0",""
"0","monitor_data <- monitor_data %>%"
"0","  mutate(vec_preis2 = as.numeric(str_replace_all(vec_preis, c(""[.]"" = """", "" €"" = """",""[,]"" = "".""))))"
"2","NAs introduced by coercion"
"0","monitor_data <- monitor_data %>%"
"0","  mutate(Datum = as.Date(substr(Timestamp_scrape, 1, 10))) %>%"
"0","  rename(id_inserat = Inserate_ID)"
"0",""
"0","# get info ob mieten oder kaufen und Haus/Wohnung"
"0","id_mieten_kaufen <- df %>% select(id_inserat, miete_kaufen, wohnung_haus) %>% distinct()"
"0",""
"0","# get initiale Miete"
"0","init_preis <- df %>% select(id_inserat, kaltmiete, kaufpreis) %>% distinct()"
"0",""
"0","# join info"
"0","monitor_data <- monitor_data %>%"
"0","  left_join(id_mieten_kaufen, by = c(""id_inserat"")) %>%"
"0","  left_join(init_preis, by = c(""id_inserat""))"
"0",""
"0","monitor_data_kaufen <- monitor_data %>%"
"0","  filter(miete_kaufen == ""kaufen"", wohnung_haus == ""Haus"")"
"0",""
